<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
	<meta charset="utf-8" />
  <script src="libs/jquery-1.11.3.js"></script>
  <script src="libs/jquery-ui.js"></script>
  <script src="libs/react/react-0.13.1.min.js"></script>
  <script src="libs/react/react-with-addons-0.13.1.min.js"></script>
  <script src="libs/linq.js_ver2.2.0.2/jquery.linq-vsdoc.js"></script>
  <script src="libs/linq.js_ver2.2.0.2/jquery.linq.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?signed_in=true"></script>
</head>
<body>
  <script>
    var testdata1 = {
      "result": {
        "status": "success",
        "record_count": "11",
        "record": [
          {
            "id": "135",
            "ename": "Galilee",
            "mname": "Nazareth",
            "cname": "加利利",
            "c1name": "加利利",
            "c2name": "加利利",
            "hsnum": "01551",
            "gsnum": "01056",
            "otype": "2",
            "objpath": "33.24044544512052,35.62098228872657,33.23296365067623,35.52310465427087,33.19555275290216,35.56007824546944,33.18009945127118,35.55657093983906,33.13110097044273,35.52939458588268,33.10451449770203,35.48731551143764,33.06292694741754,35.36211477989567,33.0666402982412,35.18286972893537,32.94991310969103,35.18614243446831,32.8603089603094,35.16577718180353,32.76703435753566,35.09933716552887,32.74851233144685,35.1531916119204,32.71974248446008,35.19209602984062,32.66384888387883,35.21221946952549,32.63724796788192,35.16217058852732,32.57712663826233,35.15737759759025,32.47741191451328,35.10045300948608,32.45360171255073,35.23350931536325,32.45338775953689,35.3381608795528,32.38188085472903,35.55733752932937,32.43665768415303,35.57425632666814,32.49420930044958,35.58955017995871,32.53360875996972,35.57976124221379,32.56300795983761,35.59659764163292,32.59530101052616,35.59844172614017,32.63759205370108,35.57852833150212,32.6753168584213,35.6120089158555,32.70477210866328,35.60235254970149,32.71754288702989,35.57068618765287,32.75405743101273,35.55935632984672,32.78500966690645,35.52770661642332,32.80890444434578,35.51787432045844,32.86643009634852,35.53498404645917,32.88870021038285,35.56176833815528,32.8872173645938,35.58684919891129,32.90388822449459,35.62203614639982,33.04845022035166,35.63984331004554,33.1511205922398,35.63730562912436,33.24044544512052,35.62098228872657",
            "is_site": "1"
          },
          {
            "id": "526",
            "ename": "Israel",
            "mname": "Israel",
            "cname": "以色列",
            "c1name": "以色列",
            "c2name": "以色列",
            "hsnum": "03478",
            "gsnum": "02474",
            "otype": "2",
            "objpath": "32.13826696915888,34.79564941372596,32.08629505637384,34.91044165688086,31.97475173126213,35.25886907338815,31.8248735280984,35.39485585434404,31.75973088074551,35.52211177535758,31.78762720523273,35.65024132440784,32.07722093050025,35.94221536455483,32.3451628030906,36.0540714044539,32.31571999772276,36.20080822152113,32.63926742260204,36.66594816633825,33.22969249924871,36.67868789914048,33.7342419462063,36.58242898382477,33.88287758794633,36.4101611394187,34.02093740155217,36.32928298109335,34.09210957754205,36.18072031602581,33.98807439844965,35.94746680330105,33.7776877681377,35.78124251944548,33.60624580759805,35.65448146581931,33.39443565632211,35.50857365941523,33.2987128601436,35.31512299645482,33.10595778348218,35.22302275145308,33.09387406746998,35.11201829322513,32.9208032508304,35.08276762152629,32.79992662783928,35.04405594084526,32.82396913832815,34.9720175286722,32.13826696915888,34.79564941372596",
            "is_site": "1"
          },
          {
            "id": "8",
            "ename": "Nazareth",
            "mname": "Nazareth",
            "cname": "拿撒勒",
            "c1name": "拿撒勒",
            "c2name": "拿撒勒",
            "hsnum": "00000",
            "gsnum": "03480",
            "otype": "0",
            "objpath": "32.694595,35.311636",
            "is_site": "1"
          },
          {
            "id": "63",
            "ename": "Ramah",
            "mname": "Masyoun St.",
            "cname": "拉瑪",
            "c1name": "拉瑪",
            "c2name": "拉瑪",
            "hsnum": "07414",
            "gsnum": "04471",
            "otype": "0",
            "objpath": "31.85,35.23330",
            "remark": "31.896378, 35.20173",
            "is_site": "1"
          },
          {
            "id": "523",
            "ename": "Judea",
            "mname": "Judea",
            "cname": "猶太",
            "c1name": "猶太",
            "c2name": "猶太",
            "hsnum": "00000",
            "gsnum": "02449",
            "otype": "2",
            "objpath": "31.3190764750298,35.3823075438589,31.34251423824735,35.4189369641776,31.38194492984652,35.40546410548561,31.46163913100401,35.40173130906372,31.51139976391161,35.39516073414828,31.54472535059071,35.40075973791508,31.56668613743429,35.41648031537262,31.57818640714156,35.41335137355691,31.60735181885924,35.40606069571245,31.61783044504752,35.42086880556484,31.64425081714542,35.43550328389673,31.66627379218074,35.44598157072448,31.68657027543773,35.44502364307383,31.70236521644182,35.4721265031942,31.74114145542055,35.48895839455079,31.76579923582636,35.5078381301553,31.76128660302902,35.53801531531712,31.76310308152114,35.56224209534078,31.80294966048176,35.5529931120756,31.83741875326569,35.55312516740572,31.85602137129476,35.5438117947307,31.87545476116392,35.54389520745332,31.89049426979578,35.53874504526698,31.91085713732899,35.52736015529496,31.91966803250148,35.53157486377989,31.93108173779277,35.54623912952783,31.9452320473413,35.54108901872785,31.98230819568951,35.54232717019656,32.01239604360134,35.52369627589285,32.02297752115281,35.52688785505725,32.06533534083262,35.53236083833357,32.07330250596494,35.52613861737264,32.07517786973379,35.49167581469261,32.07616950139981,35.44458561112101,32.07172352323519,35.3991075948474,32.0417259269939,35.37949570405321,32.01453248407036,35.36452277144438,32.01193376122893,35.34779674145589,32.03030233672639,35.32565995963841,32.06795618898322,35.30109412167801,32.0786733759087,35.23942583915517,32.08151559171473,35.20452321103896,32.07181064139439,35.15679843276832,32.03777706334589,35.13101935994664,32.02905369441155,35.03778994864864,32.05453460178951,35.02327071571799,32.06074724542083,35.00037130068926,32.0537740896479,34.95868881274688,32.08021173103781,34.94406582044287,32.11570443710473,34.92196993762555,32.12369744015761,34.89065413355942,32.12978596756943,34.84899746439432,32.05113874727679,34.80239189027925,32.06000304165364,34.75741534160397,32.02584052340705,34.73865517009691,31.97721994677182,34.72011223041298,31.93237283423249,34.76617456541454,31.79997850615509,34.71454568492658,31.76284916271975,34.82919561872091,31.64176175939026,34.92744368085463,31.57502314869357,34.91514690575234,31.5346711580799,34.98859994942114,31.483937686348,34.98774034488984,31.46561370521619,35.01650160758659,31.48399813048235,35.08927771750013,31.4122284585015,35.31781681769708,31.33251989066164,35.34195213211897,31.3190764750298,35.3823075438589",
            "is_site": "1"
          },
          {
            "id": "1265",
            "ename": "resurrection",
            "mname": "復活",
            "cname": "復活",
            "c1name": "復活",
            "c2name": "復活",
            "hsnum": "00000",
            "gsnum": "01453",
            "otype": "0",
            "is_site": "0"
          },
          {
            "id": "2",
            "ename": "Bethlehem",
            "mname": "Bethlehem",
            "cname": "伯利恆",
            "c1name": "伯利恆",
            "c2name": "伯利恆",
            "hsnum": "01035",
            "gsnum": "00965",
            "otype": "0",
            "objpath": "31.705375,35.210246",
            "is_site": "1",
            "related": "伯利恆之牧羊人野地，請參考編號ref:1167"
          },
          {
            "id": "57",
            "ename": "Egypt",
            "mname": "Egypt",
            "cname": "埃及",
            "c1name": "埃及",
            "c2name": "埃及",
            "hsnum": "04714",
            "gsnum": "00125",
            "otype": "2",
            "objpath": "31.64915409041686,25.17276567808831,31.46714401528165,25.03707780394297,31.42310373247224,24.88326002023807,31.30801964864344,24.91838734394278,31.16332960303748,24.89078464588336,30.88441265159805,25.02214803564785,30.74777661172025,25.03906580938365,30.53287693808197,24.93722737982347,30.33347028461077,24.80716750509219,30.14519373116983,24.74466306935039,29.90409638183978,24.83879982477789,29.63762413033126,24.89225149596325,29.3158839469837,24.96036615537444,29.11442728303726,25.04005036244226,28.66397120671686,25.02539373548841,27.93608195608692,24.96818663474249,21.98542735298492,25.01802425846629,22.01296803278129,36.88556849590731,22.64973187372915,36.20302210157819,22.66271097161163,35.95212554277816,22.90956799328152,35.72710673796789,23.14693351201947,35.60716013421645,23.38772871499751,35.52809757801679,23.60886460568958,35.45213508305601,23.85711212103663,35.45486001681466,23.91483272274974,35.63264432984028,23.89291795439433,35.78148805462803,24.1324552132681,35.53662312459638,24.42168683712962,35.24251853647485,24.65141376423811,35.10291970487821,25.00986420191032,34.94310748472779,25.38051400867236,34.73948759638317,25.85251597710734,34.45683626998347,26.37495412500099,34.14411603637316,26.85904580731649,33.98282224848209,27.19891219213762,33.86509537930257,27.60879820857378,33.56659702072668,27.77351556573243,33.53962537276158,27.99324594568051,33.50360218436087,28.36812946827506,33.08035055168457,28.72548508825059,32.80656343515684,28.94454853294989,32.61913944133482,29.17101116459193,32.62267502569611,29.41477067636837,32.47264295280628,29.58788810158867,32.35591177856059,29.83290401925126,32.48556409100598,29.99846574976187,32.5866030130238,30.18708827650337,32.57544678029649,30.72512582954362,32.45939383726741,30.98636487575552,32.54531007632615,31.1367972591166,32.51901651516311,31.32174803270263,32.17714762336175,31.50585050540174,31.96656174569271,31.47984908489591,31.63876343914889,31.5193443186512,31.36492084336033,31.52686063111451,31.14129356312143,31.6032850476494,30.9927050418254,31.41294023763617,30.47492968492648,31.24712717016472,29.99796980977307,31.11218804276328,29.7377596711346,30.98346162451604,29.52119624482769,30.87980620588434,29.34393759242869,30.83836410837456,29.06369245613415,30.93456738447813,28.79579033638008,31.08409171802799,28.49124751371859,31.1476494293653,28.0017131594097,31.19269762657428,27.64981923994635,31.3144185285932,27.41328975460695,31.39605291970525,27.3004674219447,31.48793972541402,26.86162154883077,31.50866882557161,26.3452511441282,31.59996094074995,25.89787339763183,31.55141219177209,25.58188392035319,31.59846670144751,25.23573790685377,31.64915409041686,25.17276567808831",
            "is_site": "1",
            "related": "金字塔，請參考編號ref:1135 尼羅河，請參考編號ref:168"
          },
          {
            "id": "1",
            "ename": "Jerusalem",
            "mname": "Jerusalem",
            "cname": "耶路撒冷",
            "c1name": "耶路撒冷",
            "c2name": "耶路撒冷",
            "hsnum": "03389",
            "gsnum": "02414",
            "otype": "0",
            "objpath": "31.786235, 35.202731",
            "is_site": "1"
          },
          {
            "id": "1297",
            "mname": "希律",
            "cname": "希律",
            "c1name": "希律",
            "c2name": "希律",
            "hsnum": "00000",
            "gsnum": "02264",
            "otype": "0",
            "is_site": "0"
          },
          {
            "id": "35",
            "ename": "Sea of Galilee",
            "mname": "Sea of Galilee",
            "cname": "加利利海",
            "c1name": "加利利海",
            "c2name": "加利利湖",
            "hsnum": "00000",
            "gsnum": "01056",
            "otype": "2",
            "objpath": "32.85149926470454,35.64833505503034,32.85065468992246,35.64855932007832,32.85763291737405,35.6457658751264,32.85921150712392,35.64444066513889,32.86219360695373,35.64246321456633,32.86359757549317,35.64384239150959,32.86468373889793,35.64338798678843,32.86932393204958,35.64032001204488,32.87442819318007,35.63689055919916,32.87764761228755,35.63410441001285,32.88060692844159,35.63128554642437,32.88502687953731,35.62797863298579,32.8880152287928,35.62545872587384,32.88940416437372,35.62351973752453,32.89141072282614,35.62220114376878,32.89159990551971,35.62071478379035,32.89271062631605,35.61942534579151,32.89340549365684,35.61842178910139,32.89427765140461,35.61687959386188,32.89485879196509,35.61587404360029,32.89567574112311,35.61419541995002,32.89666572316946,35.6123166770482,32.89719080858104,35.6112424082051,32.89737228262745,35.61036522727224,32.89697519453262,35.6102904893423,32.89726951310419,35.60948302567365,32.89705220695964,35.60866653409889,32.89672204128768,35.6077803397972,32.89667442678693,35.60703457786353,32.89645794653392,35.60615041530036,32.89624062850081,35.60533397151843,32.89601995166231,35.60478834460652,32.89562789833225,35.60430742517575,32.89512801898159,35.60335060016996,32.89423272788752,35.60218369852521,32.8937303284097,35.60143001126457,32.89310921994836,35.6010805378852,32.8926619871608,35.60046327756103,32.89198988713758,35.59963895173772,32.89166470273546,35.59834673123349,32.89139801711446,35.59692012348599,32.89147989051985,35.59489022655346,32.89110697749198,35.59285240608551,32.89044148908455,35.59148660599951,32.88949539351507,35.59150314084609,32.88874971122824,35.59203187599164,32.88829988625972,35.59161766368574,32.88779901722027,35.59072851634778,32.88730229545483,35.58950089271632,32.88720848183782,35.58787402868521,32.88694327683383,35.58631192297899,32.88616312574756,35.5850117598528,32.88577676849911,35.5840570555592,32.8853912376652,35.5830346757943,32.88482442424351,35.58288941621497,32.88420572370985,35.58233698999406,32.8837023643379,35.5816511572575,32.88326823203786,35.57995089905531,32.88270554678174,35.57946719839872,32.88175236923065,35.57836740496263,32.88119463080137,35.57747759537527,32.8804745930556,35.57590795698505,32.88029592909618,35.5744852108712,32.88031557183746,35.57286029405692,32.88010452718832,35.5715023050854,32.88018752336672,35.56933682703027,32.879852135751,35.56885704079086,32.87986193161444,35.56804464162896,32.87953062861715,35.56722639363031,32.87913839473136,35.56674566080983,32.8784627319132,35.5661923525044,32.87733309769825,35.56556354453014,32.87660140935929,35.56494159349634,32.87581614527552,35.56404793503135,32.8753143023841,35.56322686388994,32.87504555617583,35.56193587720468,32.87472890614238,35.55989936935396,32.87395420700754,35.55812589098534,32.87306255272162,35.5566212783877,32.8728676464441,35.55391002202261,32.8725557551494,35.5514676108769,32.87171927335885,35.55009949033088,32.87128635442532,35.54826437401788,32.87086794703896,35.5452110334333,32.86813683120684,35.54224054613439,32.86701273052513,35.54113840655448,32.8660575771511,35.54017455499485,32.86493269249651,35.53914018900213,32.86334983413512,35.53836892279939,32.86251399775717,35.53693336035462,32.86155724788478,35.53610500237174,32.86059568511555,35.53568271256249,32.85958209014171,35.53485344698829,32.85861572411102,35.53483723100673,32.85810492107034,35.53476097622904,32.85759331447864,35.53475238865767,32.85647564051275,35.53310922357382,32.85471139143223,35.53295840150372,32.85346196061741,35.53260589461569,32.85209090542634,35.5307591937985,32.85112783392992,35.52974834062754,32.85003336396998,35.52807211979186,32.84879179296321,35.52705666517585,32.8474070762848,35.52637038980606,32.84589091691503,35.52501880648823,32.84395307070616,35.52399179401574,32.84229957449775,35.52247222051935,32.84077752083702,35.52161800572605,32.83911814782525,35.52059575851067,32.83773727640381,35.51957816133414,32.83634667819485,35.51938931069515,32.83454802308572,35.5183648485875,32.83330443564363,35.51751538735277,32.83066830321957,35.51664288269541,32.82914232601534,35.51612032929026,32.82789098007797,35.51593385738885,32.82663576885737,35.51607884506447,32.82538246746044,35.51605805014943,32.82384483508155,35.51652977700839,32.82281754826852,35.51750471013038,32.82057964685291,35.51829650733207,32.81834176181098,35.5190882558035,32.81666093975404,35.51988913136111,32.81455455547986,35.52134588184363,32.81217354792214,35.52246651089891,32.8114636296153,35.52361485916899,32.81074786035662,35.52526028766195,32.80934554375616,35.52606558982728,32.80681749035579,35.52784644180674,32.80513770777569,35.52865156991327,32.80187506707991,35.53356367363045,32.80142984771997,35.53587609806394,32.80029222504228,35.53784541598397,32.79763060758882,35.53912618906655,32.79538280232091,35.54074527215398,32.79341743393814,35.5420376654677,32.78727532110521,35.54342539048999,32.78448225784167,35.54404106131759,32.7805772227212,35.544472212804,32.77694876013141,35.54507361193632,32.77428714486593,35.54635389300871,32.77219243996592,35.54681544710208,32.76924043518162,35.54908453756823,32.76094615972129,35.55859694829812,32.75953158646703,35.56039486548525,32.75715020071518,35.56151371695736,32.75462955743584,35.56263015401059,32.75238344336702,35.56408246210772,32.74957636450628,35.56585620405362,32.74775807355007,35.56648750459971,32.7445392687797,35.56775719242454,32.74063626471903,35.5680215521754,32.73630547550961,35.56910640042199,32.73156128723751,35.56967394313494,32.7293269449957,35.5701322023793,32.72807149794128,35.57027613862474,32.72640023525746,35.57024729471726,32.72530606370536,35.56857241296088,32.72363077133264,35.56887472509187,32.72166691628208,35.57000001334011,32.72025414592748,35.57163154211425,32.7159084568893,35.5738744961822,32.71407971239905,35.57533293720363,32.71197235067765,35.57678647297608,32.70887789983156,35.57921619633115,32.70689771986994,35.58166523670249,32.70602984575599,35.58429917315439,32.70599967878717,35.58678213385365,32.70597148805099,35.58909952700446,32.70580396180792,35.59141445245916,32.70605425950714,35.59373666463102,32.7065728869524,35.59689129848047,32.70820762790543,35.59989990752921,32.71107124935651,35.60491682487643,32.71188233250418,35.60691772561168,32.71325460152762,35.60859745570379,32.71531497170163,35.61095156444043,32.71737731154216,35.61314022132017,32.71861414727569,35.61448648902163,32.71984890369874,35.61599831898488,32.72109188896553,35.61684808864051,32.72234933705609,35.61653920341065,32.72317248418297,35.61754713264995,32.7256480501805,35.62007442224554,32.72854961066195,35.62194711105211,32.7303329349687,35.62413118992207,32.7321328364474,35.62499103315898,32.73311014610864,35.62583629908323,32.73434917125617,35.62701746434111,32.73642390066189,35.62821352045633,32.73822007295672,35.62940464305689,32.73932189542517,35.63041781259273,32.74083932966294,35.63160401856284,32.74305309021851,35.63280266405695,32.74429189115346,35.63398396203982,32.74582588661948,35.63384574672382,32.74749492297583,35.63404115704395,32.7487419731369,35.63456025730106,32.75096380994186,35.63509679258702,32.75304427040235,35.63579643948151,32.75444311395901,35.63532460096707,32.75568802567754,35.63600933584954,32.7570700829596,35.63686216342978,32.75859978175657,35.63705515758039,32.76027081930298,35.63708505601444,32.76124617023742,35.63693842865679,32.76207568776879,35.63745020661304,32.76318170382358,35.63813257933801,32.76512140130187,35.63899553120014,32.76694277865343,35.63819980808475,32.76833362899401,35.63839032587362,32.76930658740356,35.6385733850162,32.7709654863675,35.63959701597852,32.77305367692606,35.64012969872995,32.77431052862396,35.63949117648647,32.77571390895436,35.63868794276276,32.77822732460421,35.63823586993078,32.77935836701913,35.63693071773514,32.78144547380566,35.63713369413381,32.78369273818601,35.6356827695231,32.78495031706479,35.63537390205775,32.78591679274661,35.63605390418685,32.78729893432894,35.6369070437808,32.78825908536678,35.63808400586991,32.78963280785078,35.63959977755458,32.79129782211854,35.64029109300458,32.79268728089483,35.64064663193658,32.79435506804335,35.64100712452401,32.79547707150929,35.64020051286592,32.79742828042785,35.64007005640583,32.79993485047842,35.64011490173708,32.80145252460825,35.64146479415835,32.80353541169541,35.64199798012785,32.80603765729267,35.6425352389661,32.8082593410152,35.64306896009676,32.80992149429024,35.64375838579736,32.81060755882999,35.64459494355938,32.81241565159012,35.64462736688346,32.81477383017076,35.64516406370723,32.81852405383275,35.64556089124473,32.81949964776126,35.64541362315154,32.82061206115611,35.64543358784697,32.8231209737344,35.64515191064609,32.82521731875168,35.64486935150617,32.82676584680215,35.64391079410567,32.82887016353396,35.64278977836308,32.83026226892816,35.64281444714815,32.83152193871509,35.64234002613632,32.83333865157916,35.64187562503311,32.8336709263895,35.64270407932044,32.83471818253814,35.64289474847973,32.83496643859234,35.6436747538296,32.83653755305198,35.64532716757552,32.83950463861206,35.64960904579117,32.84186944158305,35.64981756966728,32.84423644781383,35.64986044942401,32.84842464310761,35.64910782664565,32.85149926470454,35.64833505503034",
            "is_site": "1"
          }
        ]
      }
    };
    var testdata2 = {
      "result": {
        "status": "success",
        "record_count": "2",
        "record": [
          {
            "id": "4",
            "ename": "Babylon",
            "mname": "Babylon",
            "cname": "巴比倫",
            "c1name": "巴比倫",
            "c2name": "巴比倫",
            "hsnum": "00894",
            "gsnum": "00897",
            "otype": "0",
            "objpath": "32.544679,44.421625",
            "is_site": "1"
          },
          {
            "id": "604",
            "ename": "Judah",
            "mname": "Judah",
            "cname": "猶大",
            "c1name": "猶大",
            "c2name": "猶大",
            "hsnum": "03063",
            "gsnum": "02455",
            "otype": "2",
            "objpath": "32.1405740145343,34.77519801279282,31.90090975163029,34.70014157161906,31.60932102624917,34.48872342112031,31.56906211170541,34.62141855332226,31.52864734797492,34.56023716513591,31.43158855339384,34.41925993745808,31.359098973513,34.4481648838184,31.27453359027656,34.45352535664568,31.12101991808149,34.27110173479061,31.06375215097987,34.08325342491412,30.98369518607661,34.15472969504393,30.74606173034997,34.09128014036288,30.47090624328062,33.88770908273826,30.14498738386447,33.92334512004729,29.64969869789192,34.44769381583709,29.62626271989299,34.72544523063452,29.52812104041555,34.90118715091142,29.50760700598972,35.01229440912062,29.47780595349666,35.23407851573009,29.51778443761871,35.43742902352088,29.57418283813527,35.42842400170092,29.77990983039363,35.45222413551397,29.99834504556623,35.52180213487331,30.33488926691179,35.62551379743512,30.6711133107107,35.68819863462935,30.83242881668551,35.47584800276698,30.90900947721556,35.40147695346057,30.95325797270631,35.38768817045221,31.00138360570615,35.41133439035647,31.06972550312758,35.3975969589168,31.15821730912872,35.37456581740476,31.24266170865508,35.38911667025165,31.35115579053173,35.4226053221651,31.40748839408337,35.41819423806957,31.49612567328602,35.39983167992374,31.56063120210633,35.40493595949403,31.61708404120915,35.40999423867891,31.67767362225569,35.44826630387434,31.78686997614276,35.48225893722285,31.83122516279363,35.397110176185,31.97201077470639,35.25055540242614,32.1405740145343,34.77519801279282",
            "is_site": "1"
          }
        ]
      }
    };
  </script>

  <!-- 測試的格子 -->
  <div id="re1" style="width:480px;height:640px;background-color:whitesmoke"></div>
  
  <script>
    // template
    var fhlmap = fhlmap || {};
    fhlmap.R = fhlmap.R || {
      gmap: React.createClass({
        bind_on_btw_polyline_over: function (pfn) {
          /// <summary> 將函式指標丟進來, 依次呼叫. 會傳 .na1 .na2 .dist </summary>
          this._on_btw_polyline_over.push(pfn);
        },
        _on_btw_polyline_over: [],/// <summary> 使用 bind_on_btw_polyline_over </summary>
        _trigger_btw_polyline_over: function (param) {
          /// <summary> 可供外部使用, 例如用一行文字顯示它們的兩端是哪兩個 </summary>
          /// <param type="{}" name="id" parameterArray="false"> {btwkey:"34_512"} </param>
          var ids = param.btwkey.split('_');
          var data1 = this.state.datas[ids[0]];
          var data2 = this.state.datas[ids[1]];
          var btwdata = this.state.btwdatas[param.btwkey];
          
          var bb = btwdata.polyline.getPath();
          var aa = google.maps.geometry.spherical.computeLength(bb);
          var param2 = {
            "na1": data1.cname,
            "na2": data2.cname,
            "dist": aa
          };
          if (this._on_btw_polyline_over.length == 0)
          {
            console.log(param2);
          }
          else
          {
            for (var idx in this._on_btw_polyline_over)
              this._on_btw_polyline_over[idx](param2);
          }
          
        },
        set_active: function (id)
        {
          /// <summary> 這個通常是地圖內部 click marker 呼叫, 但也可以外部呼叫, 因為將來還要作, active 會與所有的算距離, 所以active 只允許同時間1個. </summary>
          /// <param type="Int" name="id" parameterArray="false"> 這個地圖物件的id </param>

          var pthis = this;
          var btwdatas = this.state.btwdatas;
          var datas = this.state.datas;
          var btw_active = []; //目 active 有關的 btwkey ["1_254", "1_521"]
          if (id != "-1")
          {
            var lqdatas = $.Enumerable.From(datas);
            lqdatas.ForEach(function (a1, i1) {
              var active_marker = datas[id.toString()]["marker"];
              if (a1.Key != id.toString()) {
                var btwkey = (id < parseInt(a1.Key)) ? id.toString() + "_" + a1.Key : a1.Key + "_" + id.toString();
                btw_active.push(btwkey);

                if (btwdatas[btwkey] == null) {
                  var btwobj = {};
                  btwdatas[btwkey] = btwobj;

                  var path = [];
                  path.push(active_marker.getPosition());
                  path.push(datas[a1.Key]["marker"].getPosition());

                  var polyline = new google.maps.Polyline({
                    path: path,
                    geodesic: true,
                    strokeOpacity: 0.6,
                    strokeColor: "#007700",
                    //editable: true,
                    strokeWeight: 2
                    //map: pthis._map
                  });
                  btwobj["polyline"] = polyline;
                  
                  var isdown = false;
                  var tmr = null;//timer , 若mouse up啟動後, 在 down 的時候, 就再把它cancel掉
                  polyline.addListener('mouseover', function (a1) {

                    pthis._trigger_btw_polyline_over({ btwkey: btwkey });

                    polyline.setOptions({ 'editable': true });
                  });
                  polyline.addListener('mouseout', function (a1) {
                    if (isdown==false)
                      polyline.setOptions({ 'editable': false });
                  });
                  polyline.addListener('mousedown', function (a1) {
                    isdown = true;
                    if (tmr != null)
                      clearTimeout(tmr);
                  });
                  polyline.addListener('mouseup', function (a1) {
                    tmr = setTimeout(function () {
                      isdown = false ;
                      iscanceltimer = false;
                      pthis._trigger_btw_polyline_over({ btwkey: btwkey });
                      polyline.setOptions({ 'editable': false });
                    }, 5000);
                  });
                  polyline.addListener('rightclick', function (a1) {
                    if (a1.vertex == null)
                      return;//右鍵不是按在控制點上

                    if ( a1.vertex == 0 )
                      return ;// 不移除端點

                    var path = polyline.getPath();
                    if (path.getLength() - 1 == a1.vertex)
                      return;//不移除端點

                    path.removeAt(a1.vertex);
                  });
                }
              }
            });
          }

          if ( this.state.id_active != id.toString() )
            this.setState(
              {
                "id_active": id.toString(),
                "btwdatas": btwdatas,
                "btw_active":btw_active
              });
          else if (this.state.id_active == id.toString())
            this.setState(
              {
                "id_active": "-1",
                "btwdatas": btwdatas,
                "btw_active": btw_active
              });//若一樣(再點一次),則取消active
        },
        set_data: function (datas)
        {
          /// <summary> 得到 sobj 查詢資料, 用這個來更新資料, 通常是外部呼叫 </summary>
          /// <param type="JSON" name="datas" parameterArray="false"> sobj 查詢的結果 </param>
          var pthis = this;
          var datas2={};
          $.Enumerable.From(datas).Where("$.is_site == 1").ForEach(function (a1, i1)
          {
            var jo = {};

            // objpaths 
            {
              var objpath = [];
              jo["objpath"] = objpath;
              var tmp1s = $.Enumerable.From(a1.objpath.split(",")).Select(function (aa1) { return parseFloat(aa1); }).ToArray();
              for (var i in tmp1s) {
                if (i % 2 == 1)
                  objpath.push(new google.maps.LatLng(tmp1s[i - 1], tmp1s[i]));
              }
            }

            // mark
            {
              var paths = jo["objpath"];
              var position = paths[0];
              if (paths.length != 1) {
                var bound = new google.maps.LatLngBounds();
                for (var i in paths)
                  bound.extend(paths[i]);
                position = bound.getCenter();
              }

              var marker = new google.maps.Marker(
                {
                  position: position,
                  //map: pthis._map, //再用 set來打開
                  label: a1.cname
                });
              jo["marker"] = marker;

              marker.addListener("click", pthis.set_active.bind(pthis, a1.id));

              // infowindow
              marker.addListener('click', function () {
                var infowindow = new google.maps.InfoWindow({
                  content: a1.cname
                });
                infowindow.open(pthis._map, marker);
                
                setTimeout(function () {
                  infowindow.close();
                },1200);
              });
            }

            // polyline
            if (a1.otype == 1) {
              jo["polyline"] = new google.maps.Polyline(
                {
                  path: jo["objpath"],
                  map: pthis._map, //再用 set來打開
                  geodesic: true
                });
            }
            // polygon
            if (a1.otype == 2) {
              jo["polygon"] = new google.maps.Polygon(
                {
                  path: jo["objpath"],
                  //map: pthis._map, //再用 set來打開
                  geodesic: true
                });
            }
            
            // infowindows 需要的 data
            if (a1.cname != null)
              jo.cname = a1.cname;
            if (a1.ename != null)
              jo.ename = a1.ename;
            if (a1.mname != null)
              jo.mname = a1.mname;

            datas2[a1.id.toString()] = jo;
          });
          this.setState({ datas: datas2 });
          
        },
        getInitialState: function () {
          return {
            "datas": {},
            "id_active": "-1",
            "btwdatas": {},
            "btw_active":[]
          };
        },
        componentDidMount: function ()
        {
          var thisdom = this.getDOMNode();
          this._map = new google.maps.Map(thisdom, {
            center: { lat: 31.786235, lng: 35.202731 },// 耶路撒冷
            zoom: 7
          });
        },
        render: function()
        {
          var pthis = this;

          // markers
          $.Enumerable.From(this.state.datas).ForEach(function (a1)
          {
            var jo = a1.Value;
            if (jo.marker != null){
              jo.marker.setMap(pthis._map);
              jo.marker.setOptions({ "optimized": false, "zIndex": parseInt( a1.Key) });
            }
            if (jo.polyline != null)
              jo.polyline.setMap(pthis._map);
            if (jo.polygon != null)
            {
              jo.polygon.setMap(pthis._map);
              jo.polygon.setOptions({
                strokeWeight: 0.5,
                strokeColor: "#000000"
              }); //先所有還原成黑色,下面再把active設為藍色
            }
          });

          // btws
          $.Enumerable.From(this.state.btwdatas).ForEach(function (a1) {
            var jo = a1.Value;
            if (jo.polyline != null){
              jo.polyline.setMap(null);
            }
          });

          // id_active
          if (this.state.datas[this.state.id_active] != null)
          {
            // marker 變 zIndex
            var jo = this.state.datas[this.state.id_active];
            if (jo.marker != null)
            {
              jo.marker.setOptions({ "optimized": false, "zIndex":99999 });
            }

            // polygon 變 色框
            if ( jo.polygon!=null ) 
            {
              jo.polygon.setOptions({
                strokeWeight: 2,
                strokeColor: "#0000FF"
              }); //先所有還原成黑色,下面再把active設為藍色
            }

            // 距離 polyline show
            var btwacts = this.state.btw_active;
            $.Enumerable.From(btwacts).ForEach(function (a1, i1)
            {
              var jbtw = pthis.state.btwdatas[a1];
              if (jbtw == null)
                return;
              jbtw["polyline"].setMap(pthis._map);
            });

          }

          return React.createElement("div", { "style": {"width":"100%","height":"100%"}}, "gmap");
        }
      }),
      top: React.createClass({
        set_text: function (txt){
          this.setState({"info":txt});
        },
        getInitialState: function () { return {"info":"請點擊marker"}; },
        render: function () {
          return React.createElement("div", { }, this.state.info);
        }
      }),
      frame: React.createClass({
        set_data: function (datas){
          /// <summary> 得到 sobj 查詢資料, 用這個來更新資料, 通常是外部呼叫. 會呼叫 gmap </summary>
          /// <param type="JSON" name="datas" parameterArray="false"> sobj 查詢的結果 </param>
          this.refs.gmap.set_data(datas);
        },

        getDefaultProps: function () { return {}; },
        getInitialState: function () { return {}; },
        componentWillMount: function () { },
        componentDidMount: function () {
          var pthis = this;
          this.refs.gmap.bind_on_btw_polyline_over(function (param) {
            var txt = param.na1 + " ~ " + param.na2 + " 距離 " + param.dist / 1000 + " km";
            pthis.refs.top.set_text(txt);
          });
        },
        componentWillReceiveProps: function (nextProp) { },
        componentWillUpdate: function (nextProp, nextState) { },
        componentDidUpdate: function (preProp, preState) { }, // 可於此呼叫 this.componentWillUnmount(); this.componentDidMount();
        componentWillUnmount: function () { },//通常在DidMount建的 DOM 在這裡要移除. timer 也是
        render: function () {
          var rtop = React.createElement(fhlmap.R.top, {ref:"top"});
          var rgmap = React.createElement(fhlmap.R.gmap, {ref:"gmap"});
          
          return React.createElement("div", { "style": { "width": "100%", "height": "90%" } }, rtop, rgmap);
        }
      })
    };

    // render
    var rfhlmap = React.render(React.createElement(fhlmap.R.frame, {}), document.getElementById("re1"));
    rfhlmap.set_data(testdata1.result.record);
  </script>
  
</body>
</html>
